<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ cookie_count }} still in jar</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><text x='50%25' y='50%25' font-size='48' text-anchor='middle' dominant-baseline='central'>üç™</text></svg>">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        // Auto-refresh the page every 30 seconds
        setInterval(function() {
            location.reload();
        }, 30000);

        // Check for P&L status change
        window.addEventListener('load', function() {
            // Get current hour P&L status (first pnl-line)
            const hourPnlElement = document.querySelector('.pnl-line');
            const currentHourStatus = hourPnlElement ? 
                (hourPnlElement.classList.contains('gain') ? 'gain' : 
                 hourPnlElement.classList.contains('loss') ? 'loss' : 'neutral') : 'neutral';
            
            // Check for hour P&L change
            const previousStatus = localStorage.getItem('hourPnlStatus');
            
            if (previousStatus !== null && previousStatus !== currentHourStatus) {
                if (previousStatus !== 'gain' && currentHourStatus === 'gain') {
                    // Flipped to green - play cash sound
                    const cashSound = document.getElementById('cashSound');
                    if (cashSound) {
                        cashSound.volume = 0.5;
                        cashSound.currentTime = 0;
                        cashSound.play().catch(e => console.log('Could not play cash sound:', e));
                    }
                    
                    // Add visual feedback to P&L line
                    if (hourPnlElement) {
                        hourPnlElement.classList.add('pnl-flip-gain');
                        setTimeout(() => hourPnlElement.classList.remove('pnl-flip-gain'), 2000);
                    }
                } else if (previousStatus !== 'loss' && currentHourStatus === 'loss') {
                    // Flipped to red - play down sound
                    const downSound = document.getElementById('downSound');
                    if (downSound) {
                        downSound.volume = 0.5;
                        downSound.currentTime = 0;
                        downSound.play().catch(e => console.log('Could not play down sound:', e));
                    }
                    
                    // Add visual feedback to P&L line
                    if (hourPnlElement) {
                        hourPnlElement.classList.add('pnl-flip-loss');
                        setTimeout(() => hourPnlElement.classList.remove('pnl-flip-loss'), 2000);
                    }
                }
            }
            
            // Store current status for next comparison
            localStorage.setItem('hourPnlStatus', currentHourStatus);
            
            // Handle cookie animation
            if (sessionStorage.getItem('animationPlayed')) {
                const cookies = document.querySelectorAll('.cookie-emoji');
                cookies.forEach(cookie => {
                    cookie.style.animation = 'none';
                    cookie.style.opacity = '1';
                });
            } else {
                sessionStorage.setItem('animationPlayed', 'true');
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <main>
            <div class="stats-container">
                <div class="cookie-count">
                    <span class="count">{{ cookie_count }}</span>
                    <span class="unit">cookies</span>
                </div>
                {% if leverage_display %}
                <div class="leverage-display {{ leverage_class }}">
                    {{ leverage_display }}
                </div>
                {% endif %}
            </div>
            <div class="pnl-container">
                <div class="pnl-display {{ pnl_class }}">
                    {% for line in pnl_lines %}
                    <div class="pnl-line {{ line.class }}">{{ line.text }}</div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="gif-container">
                {% if show_winning_gif %}
                    <img src="{{ url_for('static', filename='trump-winning.gif') }}" alt="Winning" class="pnl-gif">
                {% else %}
                    <img src="{{ url_for('static', filename='trump-losing.gif') }}" alt="Losing" class="pnl-gif">
                {% endif %}
            </div>
            
            <p></p>
            <p></p>
            
            <div class="cookie-section">
                <div class="jar-label">cookies still in jar</div>
                <div class="cookie-grid">
                    {% for cookie in cookie_grid %}
                    <div class="cookie-item">
                        <span class="cookie-emoji cookie-{{ loop.index0 }}">üç™</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            {% if cookie_count == 0 %}
            <div class="no-cookies-message">
                <p>No cookies yet! ü•∫</p>
            </div>
            {% endif %}
        </main>
    </div>
    
    <!-- Hidden audio elements for preloading -->
    <audio id="cashSound" preload="auto">
        <source src="{{ url_for('static', filename='cash.mp3') }}" type="audio/mpeg">
    </audio>
    <audio id="downSound" preload="auto">
        <source src="{{ url_for('static', filename='down.mp3') }}" type="audio/mpeg">
    </audio>
    
</body>
</html>

